<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro De Personas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

  <style>
    /* Fondo animado con gradiente */
    body {
      background: linear-gradient(-45deg, #667eea, #764ba2, #ff758c, #ff7eb3);
      background-size: 400% 400%;
      animation: gradientBG 12s ease infinite;
    }
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    .btn-gradient {
      background: linear-gradient(45deg, #667eea, #764ba2, #ff758c);
      transition: all 0.3s ease;
    }
    .btn-gradient:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255,255,255,0.4);
    }
    .tab-active {
      background: rgba(255,255,255,0.3) !important;
      border-bottom: 2px solid white;
    }
    input {
      transition: all 0.3s ease;
    }
    input:focus {
      box-shadow: 0 0 10px rgba(255,255,255,0.6);
    }
  </style>
</head>
<body class="min-h-screen">
  <div x-data="app()" class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-10">
      <h1 class="text-5xl font-extrabold text-white drop-shadow-lg mb-2">üöÄ Proyecto Integrador API</h1>
      <p class="text-white opacity-90 text-lg">Registro De Personas</p>
    </div>

    <!-- Notification -->
    <div x-show="notification.show"
         x-transition
         class="fixed top-6 right-6 z-50 px-6 py-4 rounded-lg shadow-lg text-white"
         :class="notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'">
      <div class="flex items-center">
        <span x-text="notification.message"></span>
        <button @click="hideNotification()" class="ml-4 text-white hover:text-gray-200 font-bold">√ó</button>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="glass-card p-2 mb-8 flex justify-center space-x-4">
      <button @click="currentTab = 'login'"
              :class="currentTab === 'login' ? 'tab-active' : ''"
              class="py-2 px-6 rounded-lg text-white font-semibold hover:bg-white hover:bg-opacity-20">
        Iniciar Sesi√≥n
      </button>
      <button @click="currentTab = 'register'"
              :class="currentTab === 'register' ? 'tab-active' : ''"
              class="py-2 px-6 rounded-lg text-white font-semibold hover:bg-white hover:bg-opacity-20">
        Registrarse
      </button>
      <button @click="currentTab = 'dashboard'"
              :disabled="!isAuthenticated"
              :class="[currentTab === 'dashboard' ? 'tab-active' : '', !isAuthenticated ? 'opacity-50 cursor-not-allowed' : '']"
              class="py-2 px-6 rounded-lg text-white font-semibold hover:bg-white hover:bg-opacity-20">
        Dashboard
      </button>
    </div>

    <!-- Login -->
    <div x-show="currentTab === 'login'" x-transition class="glass-card p-8">
      <h2 class="text-2xl font-bold text-white mb-6 text-center">üîë Iniciar Sesi√≥n</h2>
      <form @submit.prevent="login()" class="space-y-6">
        <div>
          <label class="block text-white text-sm font-medium mb-2">Email</label>
          <input type="email" x-model="loginForm.email" required
                 class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-gray-100">
        </div>
        <div>
          <label class="block text-white text-sm font-medium mb-2">Contrase√±a</label>
          <input type="password" x-model="loginForm.password" required
                 class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-gray-100">
        </div>
        <button type="submit" :disabled="loading"
                class="w-full btn-gradient text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50">
          <span x-show="!loading">Iniciar Sesi√≥n</span>
          <span x-show="loading" class="flex items-center justify-center">
            <svg class="animate-spin h-5 w-5 mr-3 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="white" stroke-width="4"></circle>
              <path class="opacity-75" fill="white" d="M4 12a8 8 0 018-8V0C5.4 0 0 5.4 0 12h4z"></path>
            </svg>
            Cargando...
          </span>
        </button>
      </form>
    </div>

    <!-- Register -->
    <div x-show="currentTab === 'register'" x-transition class="glass-card p-8">
      <h2 class="text-2xl font-bold text-white mb-6 text-center">üìù Crear Cuenta</h2>
      <form @submit.prevent="register()" class="space-y-6">
        <div>
          <label class="block text-white text-sm font-medium mb-2">Usuario</label>
          <input type="text" x-model="registerForm.username" required
                 class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white">
        </div>
        <div>
          <label class="block text-white text-sm font-medium mb-2">Email</label>
          <input type="email" x-model="registerForm.email" required
                 class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white">
        </div>
        <div>
          <label class="block text-white text-sm font-medium mb-2">Contrase√±a</label>
          <input type="password" x-model="registerForm.password" required minlength="6"
                 class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white">
        </div>
        <button type="submit" :disabled="loading"
                class="w-full btn-gradient text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50">
          <span x-show="!loading">Crear Cuenta</span>
          <span x-show="loading">Cargando...</span>
        </button>
      </form>
    </div>

    <!-- Dashboard -->
    <div x-show="currentTab === 'dashboard'" x-transition class="space-y-6">
      <div class="glass-card p-6">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-2xl font-bold text-white mb-2">üéâ Bienvenido/a</h2>
            <div x-show="user" class="text-white opacity-90">
              <p><strong>Usuario:</strong> <span x-text="user?.username"></span></p>
              <p><strong>Email:</strong> <span x-text="user?.email"></span></p>
              <p><strong>Rol:</strong> <span x-text="user?.role"></span></p>
              <p><strong>Desde:</strong> <span x-text="formatDate(user?.created_at)"></span></p>
            </div>
          </div>
          <button @click="logout()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">
            Cerrar Sesi√≥n
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="glass-card p-6 text-center text-white">
          <h3 class="text-lg font-bold">‚ö° API Activa</h3>
          <p>Todo funciona correctamente</p>
        </div>
        <div class="glass-card p-6 text-center text-white">
          <h3 class="text-lg font-bold">üíæ Base de datos</h3>
          <p>SQLite conectada</p>
        </div>
      </div>

      <div class="glass-card p-6 text-center">
        <h3 class="text-xl font-bold text-white mb-4">üìñ Documentaci√≥n</h3>
        <a href="http://localhost:8000/docs" target="_blank"
           class="btn-gradient text-white font-bold py-2 px-6 rounded-lg mr-4">
          Swagger UI
        </a>
        <a href="http://localhost:8000/redoc" target="_blank"
           class="bg-white bg-opacity-20 hover:bg-opacity-40 text-white font-bold py-2 px-6 rounded-lg">
          ReDoc
        </a>
      </div>
    </div>
  </div>




    <script>
        function app() {
            return {
                currentTab: 'login',
                loading: false,
                isAuthenticated: false,
                user: null,
                token: localStorage.getItem('token'),
                notification: {
                    show: false,
                    message: '',
                    type: 'success'
                },
                loginForm: {
                    email: '',
                    password: ''
                },
                registerForm: {
                    username: '',
                    email: '',
                    password: ''
                },

                init() {
                    // Configurar axios con la URL base de la API
                    axios.defaults.baseURL = 'http://localhost:8000';
                    
                    if (this.token) {
                        this.setAuthHeader(this.token);
                        this.getCurrentUser();
                    }
                },

                setAuthHeader(token) {
                    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                },

                async login() {
                    this.loading = true;
                    try {
                        const response = await axios.post('/auth/login', this.loginForm);
                        this.token = response.data.access_token;
                        localStorage.setItem('token', this.token);
                        this.setAuthHeader(this.token);
                        
                        await this.getCurrentUser();
                        this.currentTab = 'dashboard';
                        this.showNotification('¬°Inicio de sesi√≥n exitoso!', 'success');
                        
                        // Limpiar formulario
                        this.loginForm = { email: '', password: '' };
                    } catch (error) {
                        console.error('Login error:', error);
                        this.showNotification(
                            error.response?.data?.detail || 'Error al iniciar sesi√≥n',
                            'error'
                        );
                    }
                    this.loading = false;
                },

                async register() {
                    this.loading = true;
                    try {
                        await axios.post('/auth/register', this.registerForm);
                        this.showNotification('¬°Cuenta creada exitosamente! Ahora puedes iniciar sesi√≥n.', 'success');
                        this.currentTab = 'login';
                        
                        // Limpiar formulario
                        this.registerForm = { username: '', email: '', password: '' };
                    } catch (error) {
                        console.error('Register error:', error);
                        this.showNotification(
                            error.response?.data?.detail || 'Error al crear la cuenta',
                            'error'
                        );
                    }
                    this.loading = false;
                },

                async getCurrentUser() {
                    try {
                        const response = await axios.get('/auth/me');
                        this.user = response.data;
                        this.isAuthenticated = true;
                    } catch (error) {
                        console.error('Get user error:', error);
                        this.logout();
                    }
                },

                logout() {
                    this.token = null;
                    this.user = null;
                    this.isAuthenticated = false;
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                    this.currentTab = 'login';
                    this.showNotification('Sesi√≥n cerrada', 'success');
                },

                showNotification(message, type = 'success') {
                    this.notification = {
                        show: true,
                        message,
                        type
                    };
                    setTimeout(() => {
                        this.hideNotification();
                    }, 5000);
                },

                hideNotification() {
                    this.notification.show = false;
                },

                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }
            }
        }
    </script>
</body>
</html>